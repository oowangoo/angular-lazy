{"version":3,"sources":["angular-lazy.js"],"names":["ModuleListenList","appendModuleRequires","coverNgModule","createInvoke","head","isRegister","moduleProxy","register","registerCache","requireConfig","requireModule","stateModule","angular","module","isBootstrap","modules","moduleName","indexOf","method","_i","_len","push","name","length","$isProxy","invokeQueue","normal","isFunction","Error","result","apply","arguments","requires","appendList","baseRequires","req","Array","prototype","normalModule","fn","directive","restrict","compile","provider","$provide","$controllerProvider","$compileProvider","$filterProvider","$injector","$animateProvider","invokeLater","providerCache","providers","registerFunction","runLater","getInstanceInjector","injector","pname","args","instance","slice","call","invoke","factory","service","value","constant","animation","filter","controller","config","run","rFn","this","$get","$rootElement","instanceInjector","data","document","getElementsByTagName","setConfig","extend","$cacheFactory","getFilePath","getRequireList","list","isArray","isString","isObject","forEach","v","k","fileName","relativePath","baseRequire","findRequire","onError","noop","stateName","requireList","getFile","$q","fileCache","$rootScope","ScriptLoad","filePath","deferred","p","defer","$promise","promise","onScriptLoad","resolve","put","$apply","onScriptError","reject","remove","get","then","loadScript","url","node","bind","createNode","addEventListener","src","appendChild","createElement","type","charset","async","setAttribute","filepath","$fileLoad","$stateProvider","$fileLoadProvider","registerState","state","jsRequire","requirejs"],"mappings":"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","file":"angular-lazy.min.js","sourcesContent":["(function() {\n  var ModuleListenList, appendModuleRequires, coverNgModule, createInvoke, head, isRegister, moduleProxy, register, registerCache, requireConfig, requireModule, stateModule;\n\n  register = angular.module('angular.lazy.register', ['ng']);\n\n  register.isBootstrap = false;\n\n  registerCache = {\n    modules: ['ng']\n  };\n\n  register.isRegister = isRegister = function(moduleName) {\n    return registerCache.modules.indexOf(moduleName) !== -1;\n  };\n\n  ModuleListenList = ['provider', 'factory', 'service', 'value', 'constant', 'animation', 'filter', 'controller', 'directive', 'config', 'run'];\n\n  moduleProxy = function(module) {\n    var method, _i, _len;\n    registerCache.modules.push(module.name);\n    for (_i = 0, _len = ModuleListenList.length; _i < _len; _i++) {\n      method = ModuleListenList[_i];\n      module[method] = createInvoke(module, method);\n    }\n    module.$isProxy = true;\n    return module;\n  };\n\n  createInvoke = function(module, method) {\n    var invokeQueue, normal;\n    normal = module[method];\n    if (!normal || !angular.isFunction(normal)) {\n      throw new Error(\"badmethod  no method \" + method + \" name\");\n    }\n    invokeQueue = function() {\n      var result;\n      result = normal.apply(module, arguments);\n      if (register.isBootstrap) {\n        register.register(module, method, arguments);\n      }\n      return result;\n    };\n    return invokeQueue;\n  };\n\n  appendModuleRequires = function(moduleName, requires) {\n    var appendList, baseRequires, module, req, _i, _len;\n    module = angular.module(moduleName);\n    baseRequires = module.requires;\n    appendList = [];\n    for (_i = 0, _len = requires.length; _i < _len; _i++) {\n      req = requires[_i];\n      if (baseRequires.indexOf(req) === -1) {\n        appendList.push(req);\n      }\n    }\n    Array.prototype.push.apply(baseRequires, appendList);\n    return module;\n  };\n\n  coverNgModule = function() {\n    var normalModule;\n    normalModule = angular.module;\n    return angular.module = function(name, requires, fn) {\n      var module;\n      if (requires && isRegister(name)) {\n        return appendModuleRequires(name, requires);\n      }\n      module = normalModule(name, requires, fn);\n      if (module.$isProxy) {\n        return module;\n      }\n      return moduleProxy(module);\n    };\n  };\n\n  register.directive(\"body\", [\n    function() {\n      return {\n        restrict: \"E\",\n        compile: function() {\n          return register.isBootstrap = true;\n        }\n      };\n    }\n  ]).provider(\"register\", [\n    \"$provide\", \"$controllerProvider\", \"$compileProvider\", \"$filterProvider\", \"$injector\", \"$animateProvider\", function($provide, $controllerProvider, $compileProvider, $filterProvider, $injector, $animateProvider) {\n      var invokeLater, providerCache, providers, registerFunction, runLater;\n      providerCache = {};\n      providers = {\n        $provide: $provide,\n        $controllerProvider: $controllerProvider,\n        $compileProvider: $compileProvider,\n        $filterProvider: $filterProvider,\n        $injector: $injector,\n        $animateProvider: $animateProvider,\n        getInstanceInjector: function() {\n          return angular.injector();\n        }\n      };\n      invokeLater = function(pname, method) {\n        var provider;\n        provider = providers[pname];\n        if (!provider) {\n          throw new Error(\"badProvider unsupported provider \" + pname);\n        }\n        return function() {\n          provider[method].apply(provider, arguments);\n        };\n      };\n      runLater = function() {\n        return function() {\n          var args, instance;\n          instance = providers.getInstanceInjector();\n          args = Array.prototype.slice.call(arguments, 0);\n          return instance.invoke(args);\n        };\n      };\n      registerFunction = {\n        provider: invokeLater('$provide', 'provider'),\n        factory: invokeLater('$provide', 'factory'),\n        service: invokeLater('$provide', 'service'),\n        value: invokeLater('$provide', 'value'),\n        constant: invokeLater('$provide', 'constant', 'unshift'),\n        animation: invokeLater('$animateProvider', 'register'),\n        filter: invokeLater('$filterProvider', 'register'),\n        controller: invokeLater('$controllerProvider', 'register'),\n        directive: invokeLater('$compileProvider', 'directive'),\n        config: invokeLater('$injector', 'invoke', 'push', \"_configBlocks\"),\n        run: runLater()\n      };\n      register.register = function(module, method, args) {\n        var rFn;\n        rFn = registerFunction[method];\n        if (!rFn) {\n          throw new Error(\"badFunctioin unsupproted register \" + method);\n        }\n        rFn.apply(this, args);\n      };\n      this.$get = [\n        '$rootElement', function($rootElement) {\n          providers.getInstanceInjector = function() {\n            var instanceInjector;\n            if (instanceInjector) {\n              return;\n            }\n            return instanceInjector = $rootElement.data('$injector') || angular.injector();\n          };\n          return register.register;\n        }\n      ];\n      return this;\n    }\n  ]).run(['register', function(service) {}]);\n\n  coverNgModule();\n\n  requireModule = angular.module('angular.lazy.require', ['ng']);\n\n  head = document.getElementsByTagName(\"head\")[0];\n\n  requireConfig = {};\n\n  requireModule.setConfig = function(config) {\n    if (!config) {\n      requireConfig = {};\n    } else {\n      requireConfig = angular.extend(requireConfig, config);\n    }\n    return requireModule;\n  };\n\n  requireModule.factory(\"$fileCache\", [\n    \"$cacheFactory\", function($cacheFactory) {\n      return $cacheFactory(\"fileCache\");\n    }\n  ]).provider(\"$fileLoad\", [\n    function() {\n      var getFilePath, getRequireList, provider;\n      getRequireList = function(config) {\n        var list;\n        if (angular.isArray(config)) {\n          return config;\n        }\n        list = [];\n        if (!config) {\n\n        } else if (angular.isString(config)) {\n          list.push(config);\n        } else if (angular.isObject(config)) {\n          list = [];\n          angular.forEach(config, function(v, k) {\n            return Array.prototype.push.apply(list, getRequireList(v));\n          });\n        }\n        return list;\n      };\n      getFilePath = function(fileName, relativePath) {\n        var baseRequire;\n        baseRequire = requireModule.findRequire();\n        if (relativePath) {\n          baseRequire = baseRequire[relativePath];\n        }\n        if (!baseRequire) {\n          return '';\n        }\n        return baseRequire[fileName];\n      };\n      provider = this;\n      provider.onError = angular.noop;\n      provider.setConfig = requireModule.setConfig;\n      provider.findRequire = function(stateName) {\n        var requireList;\n        requireList = requireConfig[stateName] || [];\n        requireList = getRequireList(requireList);\n        return requireList;\n      };\n      provider.getFile = function() {};\n      provider.$get = [\n        '$q', '$fileCache', '$rootScope', function($q, fileCache, $rootScope) {\n          var ScriptLoad;\n          ScriptLoad = (function() {\n            function ScriptLoad(filePath) {\n              var deferred, p;\n              deferred = $q.defer();\n              this.$promise = deferred.promise;\n              this.onScriptLoad = function() {\n                deferred.resolve(123);\n                fileCache.put(filePath, this.$promise);\n                $rootScope.$apply();\n              };\n              this.onScriptError = function() {\n                deferred.reject('bad request');\n                fileCache.remove(filePath);\n                $rootScope.$apply();\n                angular.isFunction(provider.onError) && provider.onError();\n              };\n              if (!filePath) {\n                deferred.reject('empty path');\n              } else if ((p = fileCache.get(filePath))) {\n                p.then(function() {\n                  return deferred.resolve();\n                })[\"catch\"](function() {\n                  return deferred.reject('bad request');\n                });\n              } else {\n                fileCache.put(filePath, this.$promise);\n                this.loadScript(filePath);\n              }\n              return this;\n            }\n\n            ScriptLoad.prototype.loadScript = function(url) {\n              var node, onScriptError, onScriptLoad;\n              onScriptError = this.onScriptError.bind(this);\n              onScriptLoad = this.onScriptLoad.bind(this);\n              node = this.createNode();\n              node.addEventListener('load', onScriptLoad);\n              node.addEventListener('error', onScriptError);\n              node.src = url;\n              return head.appendChild(node);\n            };\n\n            ScriptLoad.prototype.createNode = function() {\n              var node;\n              node = document.createElement(\"script\");\n              node.type = \"text/javascript\";\n              node.charset = 'utf-8';\n              node.async = true;\n              node.setAttribute && node.setAttribute(\"ng-lazy\", \"load\");\n              return node;\n            };\n\n            return ScriptLoad;\n\n          })();\n          return provider.getFile = function(filepath) {\n            return new ScriptLoad(filepath).$promise;\n          };\n        }\n      ];\n      return provider;\n    }\n  ]).run([\"$fileLoad\", function($fileLoad) {}]);\n\n  stateModule = angular.module('angular.lazy.state', ['ng', 'ui.router', 'angular.lazy.require', 'angular.lazy.register']);\n\n  stateModule.config([\n    '$stateProvider', '$fileLoadProvider', function($stateProvider, $fileLoadProvider) {\n      var registerState;\n      registerState = $stateProvider.state;\n      return $stateProvider.state = function(name, config) {\n        var jsRequire, resolve;\n        if (config.requirejs) {\n          jsRequire = config.requirejs;\n        } else {\n          jsRequire = $fileLoadProvider.findRequire(name);\n        }\n        if (jsRequire && (resolve = config.resolve || {})) {\n          angular.forEach(jsRequire, function(v, k) {\n            resolve[\"loadJSFile\" + k] = function() {\n              return $fileLoadProvider.getFile(v, name);\n            };\n          });\n          config.resolve = resolve;\n        }\n        return registerState.apply(this, arguments);\n      };\n    }\n  ]);\n\n}).call(this);\n"]}